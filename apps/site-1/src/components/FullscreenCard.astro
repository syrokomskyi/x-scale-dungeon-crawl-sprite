---
const baseUrl = import.meta.env.BASE_URL;
---

<div
  id="fullscreen-overlay"
  class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 items-center justify-center p-4"
>
  <div
    class="bg-gray-800 rounded-lg shadow-2xl max-w-2xl max-h-full overflow-hidden border-4 border-gray-600 relative"
  >
    <img
      id="fullscreen-img"
      src=""
      alt=""
      class="w-full object-contain rounded-t-lg"
    />
    <divа
      class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black to-transparent"
    >
      <h3 id="fullscreen-name" class="text-xl text-white">
        <span id="creature-name"></span>
      </h3>
    </divа>
  </div>
</div>

<script is:inline define:vars={{ baseUrl }}>
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      window.closeFullscreen();
    }
  });

  // Listen for openFullscreen event
  document.addEventListener("openFullscreen", (e) => {
    const { path, name, icon } = e.detail;
    const overlay = document.getElementById("fullscreen-overlay");
    const img = document.getElementById("fullscreen-img");
    const creatureNameEl = document.getElementById("creature-name");
    img.src = `${baseUrl}/${path}`.replace("//", "/");
    img.alt = name;
    creatureNameEl.textContent = name;

    // Remove previous icon if exists
    const prevIcon = creatureNameEl.previousElementSibling;
    if (prevIcon && prevIcon.tagName === "IMG") {
      prevIcon.remove();
    }

    // Add icon if exists
    if (icon) {
      const iconImg = document.createElement("img");
      iconImg.src = `${baseUrl}/${icon}`.replace("//", "/");
      iconImg.alt = name;
      iconImg.className = "w-6 h-6 inline mr-2";
      creatureNameEl.before(iconImg);
    }

    overlay.classList.remove("hidden");
    overlay.classList.add("flex");
  });
</script>
